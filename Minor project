#include <stdio.h>
#include <string.h>
struct Bank {
    char name[40];
    float fd;
    float save;
    float loan;
};

void init_banks(struct Bank banks[], int n) {
    char *names[] = {
        "SBI","HDFC","ICICI","Kotak","Axis","BOB","PNB","Union","Canara","IDBI",
        "IndusInd","Yes","BOI","Indian","Central","BOM","RBL","Federal","IDFC","SouthInd"
    };

    float fdRates[] = {
        6.50,7.10,6.85,7.00,7.20,6.60,6.80,6.70,6.55,6.90,
        7.25,7.30,6.45,6.40,6.35,6.30,7.40,7.15,6.95,6.80
    };

    float saveRates[] = {
        3.00,3.25,3.00,3.40,3.50,2.75,2.90,2.85,2.70,3.10,
        3.55,3.60,2.65,2.60,2.55,2.50,3.65,3.50,3.20,3.00
    };

    float loanRates[] = {
        8.20,9.10,8.90,9.00,9.30,8.50,8.70,8.60,8.40,9.00,
        9.50,9.55,8.30,8.20,8.10,8.00,9.70,9.20,9.05,8.80
    };

    for (int i = 0; i < n; i++) {
        strcpy(banks[i].name, names[i]);
        banks[i].fd = fdRates[i];
        banks[i].save = saveRates[i];
        banks[i].loan = loanRates[i];
    }
}


void show_banks(struct Bank banks[], int n) {
    printf("\nNo.   Bank             FD Save Loan\n");
    for (int i = 0; i < n; i++) {
        printf("%3d.  %-12s    %.2f  %.2f  %.2f\n",
            i+1, banks[i].name, banks[i].fd, banks[i].save, banks[i].loan);
        }
    }
    void compare_banks(struct Bank banks[], int n) {
        int a, b;
        show_banks(banks, n);
        
        printf("Enter first bank number: ");
        scanf("%d", &a);
        printf("Enter second bank number: ");
        scanf("%d", &b);
        
        if (a < 1 || b < 1 || a > n || b > n) {
            printf("Invalid numbers\n");
            return;
        }
        
        a--; b--;
        printf("\nComparing %s vs %s\n", banks[a].name, banks[b].name);
        printf("FD: %.2f vs %.2f\n", banks[a].fd, banks[b].fd);
        printf("Save: %.2f vs %.2f\n", banks[a].save, banks[b].save);
        printf("Loan: %.2f vs %.2f\n", banks[a].loan, banks[b].loan);
   FILE *fp = fopen("history.txt", "a");
fprintf(fp, "%s vs %s\n", banks[a].name, banks[b].name);
fclose(fp);}
 
void risk_calc() {
        int t;
        printf("Types: 1-FD 2-MF 3-Gold 4-Stocks 5-Crypto\nChoose: ");
        scanf("%d", &t);
        int yrs;
        printf("years: ");
        scanf("%d",&yrs);
        
        if (t==1) printf("Low Risk\n");
        else if (t==2) printf("Medium Risk\n");
        else if (t==3) printf("Low-Medium\n");
        else if (t==4) printf("Medium-High\n");
        else printf("High Risk\n");}
    
double sip() {
        double monthly, rate, years, r;
        int n;
        FILE *hf;
        printf("\n--- SIP ---\n");
        
        printf("Monthly amount: "); scanf("%lf", &monthly);
        printf("Rate: "); scanf("%lf", &rate);
        printf("Years: "); scanf("%lf", &years);
        
        r = (rate/100) / 12;
        n = (int)(years * 12);
        
        double finalAmt = 0;
        double growth = 1 + r;
        
        for (int i = 0; i < n; i++)
        finalAmt = (finalAmt + monthly) * growth;
    
        printf("Final SIP = %.2f\n", finalAmt);
        hf = fopen("history.txt","a");
        fprintf(hf, "SIP: monthly %.2f rate %.2f%% years %.1f final %.2f\n", monthly, rate, years, finalAmt);
        fclose(hf);
        return finalAmt;
}

double swp() {
    double principal, withdrawal, rate, years, r;
    FILE *hf;
    printf("\n--- SWP ---\n");
    
    printf("Principal: "); scanf("%lf", &principal);
    printf("Withdrawal: "); scanf("%lf", &withdrawal);
    printf("Rate: "); scanf("%lf", &rate);
    printf("Years: "); scanf("%lf", &years);
    
    r = (rate/100) / 12;
    int n = (int)(years * 12);
    
    double bal = principal;
    
    for (int i = 0; i < n; i++) {
        bal = bal + bal*r - withdrawal;
        if (bal < 0) { bal = 0; break; }
    }
    
    printf("Remaining balance = %.2f\n", bal);
    hf = fopen("history.txt","a");
    fprintf(hf, "SWP: start %.2f withdraw %.2f rate %.2f%% years %.1f remain %.2f\n", principal, withdrawal, rate, years, bal);
    fclose(hf);
    return bal;}

double mypow(double base, int exp) {
        double result = 1.0;
            for (int i = 0; i < exp; i++) {
                    result *= base;}
                             return result;}
            
void investment_menu(struct Bank banks[], int n) {
    int opt;
    FILE *hf;

    while (1) {
        printf("\n-- Investment Menu --\n");
        printf("1 FD\n2 Saving\n3 Loan\n4 Gold\n5 Stocks\n6 Crypto\n7 SIP/SWP\n8 Back\nChoose: ");
        if((scanf("%d", &opt))!=1){
            return;}
       
        if (opt == 1) {
            int b; double amt, yrs;
            show_banks(banks, n);
            printf("Bank: "); scanf("%d", &b);
            printf("Amount: "); scanf("%lf", &amt);
            printf("Years: "); scanf("%lf", &yrs);

            int y = (int)yrs;
            double result = amt * mypow(1 + banks[b-1].fd/100, y);

            printf("FD final = %.2f\n", result);
            hf = fopen("history.txt","a");
            fprintf(hf, "FD: bank %s amt %.2f yrs %.1f final %.2f\n", banks[b-1].name, amt, yrs, result); 
            fclose(hf); 
        }
        else if (opt == 2) {
            int b; double amt, yrs;
            show_banks(banks, n);
            printf("Bank: "); scanf("%d", &b);
            printf("Amount: "); scanf("%lf", &amt);
            printf("Years: "); scanf("%lf", &yrs);

            int y = (int)yrs;
            double result = amt * mypow(1 + banks[b-1].save/100, y);

            printf("Saving final = %.2f", result);
            hf = fopen("history.txt","a");
            fprintf(hf, "Saving: bank %s amt %.2f yrs %.1f final %.2f\n", banks[b-1].name, amt, yrs, result);
            fclose(hf);}
        
        else if (opt == 3) {
            int b; double loanAmt, yrs, monthlyRate, months, emi;
            show_banks(banks, n);
            printf("Select bank number: "); scanf("%d", &b);
            if (b<1||b>n) {
                 printf("Bad bank\n"); continue; }
            printf("Enter loan amount: "); 
            scanf("%lf", &loanAmt);
            printf("Enter years: "); 
            scanf("%lf", &yrs);
            monthlyRate = (banks[b-1].loan/100.0)/12.0;
            months = yrs * 12.0;
            emi = (loanAmt * monthlyRate * mypow(1+monthlyRate, months)) / (mypow(1+monthlyRate, months) - 1);
            printf("Monthly EMI = %.2f\n", emi);
            hf = fopen("history.txt","a");
            fprintf(hf, "Loan: bank %s loan %.2f yrs %.1f emi %.2f\n", banks[b-1].name, loanAmt, yrs, emi); 
            fclose(hf); 
        }
        else if (opt == 4) {
            double amt, yrs,result; printf("Amt: "); scanf("%lf", &amt);
            printf("Years: "); scanf("%lf", &yrs);
            result= amt * mypow(1.08, (int)yrs);
            printf("Gold %.2f\n", result);
            hf = fopen("history.txt","a");
            fprintf(hf, "Gold: amt %.2f yrs %.1f final %.2f\n", amt, yrs, result); 
            fclose(hf); 
        }
        else if (opt == 5) {
            double amt, yrs,result; printf("Amt: "); scanf("%lf", &amt);
            printf("Years: "); scanf("%lf", &yrs);
            result=amt * mypow(1.14, (int)yrs);
            printf("Stocks %.2f\n",result );
            hf = fopen("history.txt","a");
            fprintf(hf, "Stocks: amt %.2f yrs %.1f final %.2f\n", amt, yrs, result); 
            fclose(hf); 
        }
        else if (opt == 6) {
            double amt, yrs,result; printf("Amt: "); scanf("%lf", &amt);
            printf("Years: "); scanf("%lf", &yrs);
            result=amt * mypow(1.20, (int)yrs);
            printf("Crypto %.2f\n", result);
            hf = fopen("history.txt","a");
            fprintf(hf, "Crypto: amt %.2f yrs %.1f final %.2f\n", amt, yrs, result); 
            fclose(hf); 
        }
        else if (opt == 7) {
            int s;
            printf("1 SIP\n2 SWP\nChoose: ");
            scanf("%d", &s);
            if(s==1)
            sip();
            else if(s==2)
            swp();
        }
        else if (opt == 8)
            return;
    }
}
void show_history() {
    FILE *hf = fopen("history.txt", "r");
    char line[206];
    if (fgetc(hf) == EOF ) {
        printf("No history found.\n");
        return;
    }

    printf("\n--- History ---\n");

    while (fgets(line, sizeof(line), hf) != NULL) {
        printf("%s", line);
    }

    fclose(hf);
}
void clear_history(){
    FILE *hf = fopen("history.txt", "w");
fclose(hf);
printf("History cleared successfully!\n");

}

void mf_main_menu() {
    int c;
    while (1) {
        printf("\nMF\n1 SIP\n2 SWP\n3 Back\nChoose: ");
        scanf("%d", &c);
        if (c==1) sip();
        else if (c==2) swp();
        else return;
    }
}


int main() {
    struct Bank banks[20];
    init_banks(banks, 20);

    int choice;
    while (1) {
        printf("\n=== MAIN MENU ===\n");
        printf("1 Show Banks\n2 Compare\n3 Risk\n4 Investment\n5 MF\n6 Show history\n7 Clear history\n8 Exit\nChoose: ");
        if((scanf("%d", &choice))!=1){
            return 0;
        }

        if (choice==1) show_banks(banks,20);
        else if (choice==2) compare_banks(banks,20);
        else if (choice==3) risk_calc();
        else if (choice==4) investment_menu(banks,20);
        else if (choice==5) mf_main_menu();
        else if (choice==6) show_history();
        else if (choice==7) clear_history();
        else if (choice==8) {
            printf("!Goodbye!");
            return 0;}
        else 
        printf("Please enter input (1 to 8)");}
    return 0;}
